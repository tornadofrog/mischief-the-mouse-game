
// -- user code here --

/* --- start generated code --- */

// Generated by  1.5.0 (Phaser v2.6.2)


/**
 * Level.
 */
function Level() {
	
	Phaser.State.call(this);
	
}

/** @type Phaser.State */
var Level_proto = Object.create(Phaser.State.prototype);
Level.prototype = Level_proto;
Level.prototype.constructor = Level;

Level.prototype.init = function () {
	
	this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
	this.scale.pageAlignHorizontally = true;
	this.scale.pageAlignVertically = true;
	this.stage.backgroundColor = '#acff4d';
	
};

Level.prototype.preload = function () {
	
	this.load.pack('level', 'assets/pack.json');
	
};

Level.prototype.create = function () {
	
	this.initScene();
	
	this.add.sprite(-19.0, -20.0, 'BG');
	
	this.add.tileSprite(423.0, 102.0, 373.37599182128906, 93.0, 'tiles', '14');
	
	this.add.tileSprite(309.0, 307.0, 128.0, 93.0, 'tiles', '15');
	
	this.add.tileSprite(73.0, 476.0, 128.0, 93.0, 'tiles', '13');
	
	var _player = this.add.sprite(33.0, 547.0, 'player', 0);
	_player.scale.setTo(0.25, 0.25);
	_player.anchor.setTo(0.5, 0.0);
	_player.animations.add('walk', [8, 9, 10, 11], 6, true);
	_player.animations.add('jump', [4, 5], 6, true);
	_player.animations.add('idle', [0, 1, 2], 4, true);
	this.game.physics.arcade.enable(_player);
	_player.body.setSize(211.8488311767578, 200.85348510742188, 0.0, -1.848846435546875);
	_player.body.collideWorldBounds = true;
	
	var _Mushroom_ = this.add.sprite(130.0, 451.2377088551968, 'objects', 'Mushroom_2');
	_Mushroom_.scale.setTo(0.5972855657009212, 0.5972855657009212);
	
	var _Sign_ = this.add.sprite(668.0, 418.0, 'objects', 'Sign_2');
	_Sign_.scale.setTo(0.5162706423220143, 0.5162706423220143);
	
	this.add.sprite(442.0, 37.0, 'objects', 'Bush (1)');
	
	var __7 = this.add.sprite(-2.0, 572.0, 'tiles', '17');
	__7.scale.setTo(1.4313253936432688, 1.0);
	
	this.add.tileSprite(634.0, 451.0, 63.3582763671875, 52.95611572265625, 'tiles', '2');
	
	var __71 = this.add.sprite(181.0, 573.0, 'tiles', '17');
	__71.scale.setTo(0.9715890402966008, 1.0);
	
	var __711 = this.add.sprite(305.0, 573.0, 'tiles', '17');
	__711.scale.setTo(0.9715890402966008, 1.0);
	
	var __712 = this.add.sprite(428.0, 573.0, 'tiles', '17');
	__712.scale.setTo(0.9715890402966008, 1.0);
	
	var __713 = this.add.sprite(551.0, 573.0, 'tiles', '17');
	__713.scale.setTo(0.9715890402966008, 1.0);
	
	var __714 = this.add.sprite(675.0, 573.0, 'tiles', '17');
	__714.scale.setTo(1.0064177105746555, 1.0);
	
	var _Crate = this.add.sprite(745.0, 61.0, 'objects', 'Crate');
	_Crate.scale.setTo(0.5275624532375992, 0.5275624532375992);
	
	this.add.sprite(558.0, 58.0, 'objects', 'Bush (4)');
	
	var _Bush__1_1 = this.add.sprite(614.0, 54.0, 'objects', 'Bush (1)');
	_Bush__1_1.scale.setTo(0.7530926029139844, 0.7530926029139844);
	
	var _Tree_ = this.add.sprite(370.0, 231.0, 'objects', 'Tree_2');
	_Tree_.scale.setTo(0.25353572895847737, 0.25353572895847737);
	
	var _collisionLayer = this.add.physicsGroup(Phaser.Physics.ARCADE);
	_collisionLayer.renderable = false;
	
	var _physics1 = this.add.tileSprite(309.0, 307.0, 126.34393310546875, 27.645538330078125, 'tiles', 'physics', _collisionLayer);
	_physics1.renderable = false;
	
	var _physics = this.add.tileSprite(74.0, 475.0, 126.34393310546875, 27.645538330078125, 'tiles', 'physics', _collisionLayer);
	_physics.renderable = false;
	
	var _physics2 = this.add.tileSprite(423.0, 102.0, 372.8668518066406, 27.645538330078125, 'tiles', 'physics', _collisionLayer);
	_physics2.renderable = false;
	
	var _physics3 = this.add.tileSprite(0.0, 599.0, 800.6643218994141, 27.645538330078125, 'tiles', 'physics', _collisionLayer);
	_physics3.renderable = false;
	
	var _physics4 = this.add.tileSprite(634.0, 451.0, 63.041046142578125, 27.645538330078125, 'tiles', 'physics', _collisionLayer);
	_physics4.renderable = false;
	
	var _fruits = this.add.physicsGroup(Phaser.Physics.ARCADE);
	
	this.add.sprite(274.0, 507.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(323.0, 507.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(492.0, 559.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(636.0, 413.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(646.0, 379.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(342.0, 274.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(767.0, 17.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(743.0, 28.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(717.0, 30.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(719.0, -4.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(754.0, 534.0, 'objects', 'fruit', _fruits);
	
	this.add.sprite(708.0, 544.0, 'objects', 'fruit', _fruits);
	
	_collisionLayer.setAll("body.immovable", true);
	_collisionLayer.setAll("body.allowGravity", false);
	_collisionLayer.setAll("renderable", false);
	_fruits.setAll("body.allowGravity", false);
	
	
	// public fields
	
	this.fPlayer = _player;
	this.fCollisionLayer = _collisionLayer;
	this.fFruits = _fruits;
	
};

/* --- end generated code --- */
// -- user code here --

Level.prototype.initScene = function () {
    // start the Arcade system
    this.game.physics.startSystem(Phaser.Physics.ARCADE);
 
    // set the global gravity
    this.game.physics.arcade.gravity.y = 800;
    
    // create the cursors
    this.cursors = this.input.keyboard.createCursorKeys();
};

Level.prototype.update = function () {
    this.physics.arcade.collide(this.fPlayer, this.fCollisionLayer);
    
    if (this.cursors.left.isDown) {
        // move to the left
        this.fPlayer.body.velocity.x = -200;
    } else if (this.cursors.right.isDown) {
        // move to the right
        this.fPlayer.body.velocity.x = 200;
    } else {
        // dont move in the horizontal
        this.fPlayer.body.velocity.x = 0;
    }
 
    // a flag to know if the player is (down) touching the platforms
    var touching = this.fPlayer.body.touching.down;
    
    if (touching && this.cursors.up.isDown) {
        // jump if the player is on top of a platform
        // and the up key is pressed
        this.fPlayer.body.velocity.y = -600;
    }
    
    if (touching) {
        if (this.fPlayer.body.velocity.x == 0) {
            // if it is not moving horizontally play the idle
            this.fPlayer.play("idle");
        } else {
            // if it is moving play the walk
            this.fPlayer.play("walk");
        }
    } else {
        // it is not touching the platforms so it means it is jumping.
        this.fPlayer.play("jump");
    }
    
    // TODO: Correct the stretch in x direction
    // update the facing of the player
   // if (this.cursors.left.isDown) {
        // face left
   //     this.fPlayer.scale.x = -1;
   // } else if (this.cursors.right.isDown) {
       // face right
   //    this.fPlayer.scale.x = 1;
   // }
    
    // catch when the player overlaps with a fruit
   this.physics.arcade.overlap(this.fPlayer, this.fFruits,
        this.playerVsFruit, null, this);

};

/**
 * @param {Phaser.Sprite} player
 * @param {Phaser.Sprite} fruit
 */
Level.prototype.playerVsFruit = function(player, fruit) {
    // when the player overlaps with a fruit
    // just remove the fruit from the game,
    // you can add a better effect later
    fruit.kill();
};

